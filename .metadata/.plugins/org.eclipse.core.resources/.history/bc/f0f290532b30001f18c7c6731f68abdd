import wollok.game.*

object snake {
  
  method iniciarJuego() {
  	var vibora = new Vibora()
  	var comida = new Comida()
  	var puntaje = new Puntaje()
  	
  	game.title("Juego de la Vibora")
    game.width(20)
    game.height(20)
    game.cellSize(25)
    game.ground("ground.png")
    
    keyboard.up().onPressDo { vibora.cambiarDireccion([0, 1]) }
    keyboard.down().onPressDo { vibora.cambiarDireccion([0, -1]) }
    keyboard.left().onPressDo { vibora.cambiarDireccion([-1, 0]) }
    keyboard.right().onPressDo { vibora.cambiarDireccion([1, 0]) }
    
    game.addVisualCharacter(vibora)
    game.addVisual(comida)
    game.addVisual(puntaje)
    
    game.whenCollideDo(vibora, {otro => if (otro == comida) {
        vibora.crecer()
        comida.reubicar()
        puntaje.incrementar()} else {
        game.clear()
        game.say(vibora, "Fin del Juego")}})
    
    game.onTick(500, "moverVibora", { vibora.mover() })
 }
  
 class Vibora {
    const property cuerpo = [game.at(5, 5), game.at(4, 5), game.at(3, 5)]
    var property direccion = [1, 0]
    var property nuevaCabeza
    var property image = "cabezaDerecha.png"

    method position() = cuerpo.first()

    method mover() {
      nuevaCabeza = game.at((self.position().x() + direccion.last()), (self.position().y() + direccion.first()))
      cuerpo.addFirst(nuevaCabeza)
      cuerpo.removeLast()
    }

    method cambiarDireccion(nuevaDireccion) {
      direccion = nuevaDireccion
    }

    method crecer() {
      nuevaCabeza = game.at((self.position().x() + direccion.last()), (self.position().y() + direccion.first()))
      cuerpo.addFirst(nuevaCabeza)
    }
}

  class Comida {
    var posicion = game.at(10, 10)

    method reubicar() {
      posicion = game.at((0.randomUpTo(19)), (0.randomUpTo(19)))
    }
  }
  

  class Puntaje {
    var puntos = 0

    method position() = game.origin()

    method incrementar() {
      puntos += 1
    }

    method puntaje() = "Puntaje: " + puntos
  }
