import wollok.game.*
import juego.*
import player.*

const dondeAparecer = []

class ItemEnNivel{
	var position = game.origin()
	method reubicar(){
		dondeAparecer.add(position)
		position = dondeAparecer.anyOne()
		dondeAparecer.remove(position)
	}
}

class Manzana{
	var property position = self.posicionAlAzarVacia()
	var property image = "manzana.png"

	method posicionAlAzarVacia() {
	 const posicion = self.posicionRandom()
	
		return if (self.estaOcupadaLaPosicion(posicion)) {self.posicionAlAzarVacia()} 
				else {posicion}
	}

	method posicionRandom() {
    	return game.at((1.randomUpTo(game.width())), (1.randomUpTo(game.height())))
	}


	method estaOcupadaLaPosicion(pos) {
    	return lasPartesDeSnake.any({parte => parte.position() == pos})
	}
	
	method reubicar(){
		dondeAparecer.add(position)
		position = self.posicionAlAzarVacia()
		dondeAparecer.remove(position)
		game.addVisual(self)
	}
	
	method comido(v){
	const nuevaParte = new ParteDeSnake(
        nroDeParte = lasPartesDeSnake.last().nroDeParte() + 1,
        position = lasPartesDeSnake.last().position(),
        jugadorV = v
    )
    
    nuevaParte.aDondeIr(lasPartesDeSnake.last().aDondeIr())
    nuevaParte.siguienteaDondeIr(lasPartesDeSnake.last().siguienteaDondeIr())
    
    lasPartesDeSnake.add(nuevaParte)
    
    game.addVisual(nuevaParte)
    game.removeVisual(self)
    self.reubicar()
}
	     
	}
}